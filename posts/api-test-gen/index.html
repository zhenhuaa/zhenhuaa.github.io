<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>åŸºäºOpenAPIçš„æµ‹è¯•ä»£ç ç”Ÿæˆ - Pacman&#39;s Blog</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta itemprop="name" content="åŸºäºOpenAPIçš„æµ‹è¯•ä»£ç ç”Ÿæˆ">
<meta itemprop="description" content="æœ¬æ–‡ä»‹ç»äº†ä»OpenAPI Specæ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆæ¥å£æµ‹è¯•çš„æ–¹æ³•"><meta itemprop="datePublished" content="2021-07-04T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2021-07-04T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="301">
<meta itemprop="keywords" content="OpenAPI,Test,CodeGen," /><meta property="og:title" content="åŸºäºOpenAPIçš„æµ‹è¯•ä»£ç ç”Ÿæˆ" />
<meta property="og:description" content="æœ¬æ–‡ä»‹ç»äº†ä»OpenAPI Specæ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆæ¥å£æµ‹è¯•çš„æ–¹æ³•" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhenhuaa.github.io/posts/api-test-gen/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-04T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-07-04T00:00:00&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="åŸºäºOpenAPIçš„æµ‹è¯•ä»£ç ç”Ÿæˆ"/>
<meta name="twitter:description" content="æœ¬æ–‡ä»‹ç»äº†ä»OpenAPI Specæ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆæ¥å£æµ‹è¯•çš„æ–¹æ³•"/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://zhenhuaa.github.io/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://zhenhuaa.github.io/css/main.css" />

        <link id="dark-scheme" rel="stylesheet" type="text/css" href="https://zhenhuaa.github.io/css/dark.css" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://zhenhuaa.github.io/js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="https://zhenhuaa.github.io/">
				<img src="https://avatars0.githubusercontent.com/u/9764547?s=460&amp;u=2ad547d3f8c043586d2b6de2044868ae174fe575&amp;v=4" alt="Pacman&#39;s Blog" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="https://zhenhuaa.github.io/">Pacman&#39;s Blog</a></h1>
	<div class="site-description"><p>A Web Developer</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/zhenhuaa" title="Github"><i data-feather="github"></i></a></li><li><a href="/index.xml" title="RSS"><i data-feather="rss"></i></a></li></ul>
		</nav><span class="scheme-toggle"><a href="#" id="scheme-toggle"></a></div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">All posts</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">04</span>
							<span class="rest">Jul 2021</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">åŸºäºOpenAPIçš„æµ‹è¯•ä»£ç ç”Ÿæˆ</h1>
				</div>
			</div>
					
			<div class="markdown">
				<h3 id="èƒŒæ™¯ä»‹ç»">èƒŒæ™¯ä»‹ç»</h3>
<p>OpenAPI<a href="#refer-anchor"><!-- raw HTML omitted -->1<!-- raw HTML omitted --></a>æ˜¯ä¸€ç§ç”¨äºæè¿°RESTæ¥å£,å’Œè¯­è¨€æ— å…³çš„æ¥å£å®šä¹‰è§„èŒƒï¼Œå¯ç”¨äºæ–‡æ¡£ç”Ÿæˆ, ç”Ÿæˆä¸åŒè¯­è¨€å®¢æˆ·ç«¯ç­‰å¤šç§ç”¨é€”, æœ¬æ–‡ä¸»è¦é˜è¿°åˆ©ç”¨OpenApiçš„æ¥å£è§„èŒƒæ¥è‡ªåŠ¨ç”ŸæˆåŸºäºSuperTest<a href="#refer-anchor"><!-- raw HTML omitted -->2<!-- raw HTML omitted --></a>
çš„æ¥å£æµ‹è¯•ä»£ç </p>
<h3 id="openapiæ¦‚è§ˆ">OpenAPIæ¦‚è§ˆ</h3>
<h4 id="æ¥å£å®šä¹‰">æ¥å£å®šä¹‰</h4>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">  /news/list
    get:                                                                      
     tags:                                                                   
       - news                                                                
     summary: æ–°é—»åˆ—è¡¨                                                     
     parameters:                                                             
       - $ref: <span style="color:#a31515">&#34;#/components/parameters/userIdOptional&#34;</span>
       - $ref: <span style="color:#a31515">&#34;#/components/parameters/searchKw&#34;</span>                            
       - $ref: <span style="color:#a31515">&#34;#/components/parameters/page&#34;</span>                                
       - $ref: <span style="color:#a31515">&#34;#/components/parameters/pageSize&#34;</span>                          
     responses:                                                              
       &#34;200&#34;:                                                                
         $ref: <span style="color:#a31515">&#34;#/components/responses/NewListRes&#34;</span>                         
</code></pre></div><p>è¯¥ä»£ç ç‰‡æ®µç”¨OpenAPIæè¿°äº†ä¸€ä¸ªæ–°é—»åˆ—è¡¨æ¥å£,  æ¥å£è·¯å¾„ä¸º<code>/news/list</code>, æœ‰å››ä¸ªå‚æ•°, è¿”å›ä¸ºNewListç»“æ„çš„æ¥å£, æ³¨æ„$refè¯­æ³•ï¼Œ ä¸ºäº†å¤ç”¨å‚æ•°å’Œè¿”å›çš„ç»“æ„å®šä¹‰, OpenAPIè§„èŒƒå…è®¸æˆ‘ä»¬ä½¿ç”¨<code>$ref</code>è¯­æ³•å¼•ç”¨åœ¨compoentsæ¨¡å—é‡Œå®šä¹‰çš„ç»„ä»¶å®šä¹‰</p>
<h4 id="å¼•ç”¨çš„å‚æ•°å’Œè¿”å›ç»“æ„">å¼•ç”¨çš„å‚æ•°å’Œè¿”å›ç»“æ„</h4>
<h5 id="å‚æ•°ç‰‡æ®µ">å‚æ•°ç‰‡æ®µ</h5>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">  userIdOptional:
    name: userId
    in: query
    required: <span style="color:#00f">false</span>
    description: ç”¨æˆ·id
    schema:
      type: number
      example: 10
</code></pre></div><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹å‚æ•°çš„å¼•ç”¨å®šä¹‰, å‚æ•°è¿™é‡Œæœ€é‡è¦çš„å‚æ•°åå­—ä¹Ÿå°±æ˜¯nameä»¥åŠschema, nameè¡¨ç¤ºäº†å‚æ•°çš„å­—æ®µåï¼Œschemaè§„èŒƒäº†å‚æ•°çš„shape, å…¶ä»–å‚æ•°ç±»ä¼¼</p>
<h5 id="è¿”å›ç»“æ„">è¿”å›ç»“æ„</h5>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">  NewListRes:
    description: OK
    content:
      application/json:
        schema:
          type: object
          properties:
            code:
              type: number
              example: 0
            data:
              type: object
              properties:
                list:
                  type: array
                  description: æ–°é—»åˆ—è¡¨
                  items:
                    $ref: &#34;#/components/schemas/NewsItem&#34;

</code></pre></div><p>è¿”å›ç»“æ„ä¾‹å­å¦‚å›¾ï¼Œç”±æ­¤å¯çŸ¥ï¼Œ è¯¥è¿”å›ä¸ºjsonç»“æ„ï¼Œæœ‰codeå’Œdataä¸¤ä¸ªå­—æ®µï¼Œ dataæ˜¯ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡é‡Œçš„listå¼•ç”¨äº†ä¸€ä¸ªNewsItemçš„schemaç»“æ„</p>
<h4 id="æœŸæœ›ç”Ÿæˆçš„ä»£ç ">æœŸæœ›ç”Ÿæˆçš„ä»£ç </h4>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript">  it(<span style="color:#a31515">&#34;should get newsList ok!&#34;</span>, <span style="color:#00f">async</span> () =&gt; {
    <span style="color:#00f">const</span> qs: <span style="color:#2b91af">NewsReq.NewsList</span> = {
      userId: <span style="color:#2b91af">10</span>,
      kw: <span style="color:#a31515">&#34;æ˜¾å¡ç¦åˆ©&#34;</span>,
      page: <span style="color:#2b91af">1</span>,
      pageSize: <span style="color:#2b91af">10</span>,
    };

    <span style="color:#00f">const</span> res = <span style="color:#00f">await</span> apiTest
      .<span style="color:#00f">get</span>(prefix + <span style="color:#a31515">&#34;/news/list&#34;</span>)
      .query(qs)
      .expect(200);

    <span style="color:#00f">const</span> body = res.body;
    assert.equal(body.code, 0);

    <span style="color:#00f">const</span> data: <span style="color:#2b91af">NewsRes.NewsList</span> = body.data;
    assert.ok(data);
  });

</code></pre></div><h3 id="éœ€æ±‚åˆ†æ">éœ€æ±‚åˆ†æ</h3>
<p>è¾“å…¥çš„æ˜¯æè¿°OpenAPIçš„yamlæ–‡ä»¶ï¼Œ è¾“å‡ºæ˜¯åŸºäºsupertestçš„æµ‹è¯•ç”¨ä¾‹tsä»£ç ,  å¯ä»¥ä½œä¸ºæµ‹è¯•çš„ä¸€éƒ¨åˆ†è·‘åœ¨CIä¸­</p>
<h3 id="å¯è¡Œæ€§åˆ†æ">å¯è¡Œæ€§åˆ†æ</h3>
<p>ä»ä¸¾ä¾‹çš„æ–‡æ¡£ç»“æ„å¯çŸ¥ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ªæ¥å£æè¿°ä¸­ï¼Œè¯¦å°½çš„æè¿°äº†æ¥å£çš„HTTP Method, æ¥å£çš„URLï¼Œ å‚æ•°åˆ—è¡¨, è¿”å›ç»“æ„, æ•…è€Œå¯ä»¥æ ¹æ®æ–‡æ¡£çš„æè¿°è‡ªåŠ¨æŒ‰ç…§æ–‡æ¡£ä¸­urlæ¥è¯·æ±‚, ç„¶åä½¿ç”¨å‚æ•°çš„scehmaçš„exampleå€¼æ¥è¯·æ±‚æ¥å£, è·å–è¿”å›æ•°æ®ï¼Œä»è€Œè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹, ä¹Ÿæ˜¯è¯´æ–‡æ¡£æè¿°å³ä¸ºæµ‹è¯•ç”¨ä¾‹ ä»è€Œæ‘†è„±äººå·¥ç¼–å†™æµ‹è¯•çš„ç¹ç, æé«˜ç”Ÿäº§æ•ˆç‡</p>
<h3 id="éš¾ç‚¹åˆ†æ">éš¾ç‚¹åˆ†æ</h3>
<ol>
<li>å‚æ•°ç±»å‹å¤šæ ·ï¼Œ å‚æ•°ä¸ä»…éœ€è¦æ”¯æŒquerystringï¼Œ è¿˜éœ€è¦å¤„ç†pathParamsï¼Œ è¿˜éœ€è¦å¤„ç†reqBodyæ ¼å¼</li>
<li>refè¯­ä¹‰å¤„ç†ï¼Œ schemaç»“æ„ä¸­çš„refå¯ä»¥é€’å½’å¼•ç”¨ï¼Œåœ¨ç”Ÿæˆæµ‹è¯•å‚æ•°çš„æ—¶å€™ï¼Œéœ€è¦resolveæ‰€æœ‰refï¼Œå¹¶ç”Ÿæˆæ­£ç¡®æ ¼å¼çš„æµ‹è¯•ä¾‹å­</li>
<li>å®¹é”™å¤„ç†ï¼Œç›®å‰OpenApiæ˜¯äººå·¥æ‰‹å†™ç»´æŠ¤, å¯èƒ½éƒ¨åˆ†ç»“æ„ä¹¦å†™ä¿¡æ¯å¹¶ä¸å®Œå–„ï¼Œè¿™ç§æƒ…å†µä¸‹ç”Ÿæˆå™¨éœ€è¦å®¹é”™</li>
</ol>
<h3 id="è§£å†³æ–¹æ³•">è§£å†³æ–¹æ³•</h3>
<ol>
<li>å¯¹äºè¦æ”¯æŒçš„å‚æ•°ç±»å‹ä¸åŒç±»å‹åˆ†åˆ«ç¼–å†™ç‹¬ç«‹çš„unit testï¼Œ å…ˆå®Œæˆä¸€å°éƒ¨åˆ†åœ¨è‡ªåº•å‘ä¸Šçš„é›†æˆåˆ°åˆ°æ•´ä¸ªcodebaseä¸­</li>
<li>refè¯­ä¹‰å¤„ç†, åŸºäºä¸åŒtypeå¯¹schemaè¿›è¡ŒDFSéå†, æ£€æµ‹åˆ°refç»“æ„åï¼Œæ ¹æ®refè·¯å¾„æŸ¥è¯¢æ•´ä¸ªæ–‡æ¡£å¹¶è§£æï¼Œä¹‹åä¸æ–­é‡å¤ï¼Œç›´åˆ°æ²¡æœ‰refç»“æ„ä½ç½®</li>
<li>å®¹é”™å¤„ç†, å¼€å¯tsçš„stricté€‰é¡¹ï¼Œ å¯¹æ‰€æœ‰å¯èƒ½ä¸å­˜åœ¨çš„å±æ€§ç”¨ç¼–è¯‘å™¨ç¡®ä¿å®Œæˆäº†nullcheck, å¹¶ä¸”åœ¨ä½¿ç”¨ç”Ÿæˆå™¨ä¹‹å‰å¼•å…¥linter, ç¡®ä¿æ–‡æ¡£ç»“æ„æ­£ç¡®</li>
</ol>
<h3 id="å®Œæˆæ•ˆæœå±•ç¤º">å®Œæˆæ•ˆæœå±•ç¤º</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">â¯ openapi-code-gen ~/Workspace/fight-app/doc/swagger.json -o ~/Workspace/fight-app -t <span style="color:#a31515">&#39;news&#39;</span> -i apiTest --dryRun
âœ¨ openapi-component 1.0.24
ğŸ”­ Loading spec from /Users/zhenhua/Workspace/fight-app/doc/swagger.jsonâ€¦
generate component apiTest to /Users/zhenhua/Workspace/fight-app/test/components/news/index.test.ts
import { apiTest, prefix } from <span style="color:#a31515">&#34;../../testHelper&#34;</span>;
import * as assert from <span style="color:#a31515">&#34;power-assert&#34;</span>;
import { NewsReq, NewsRes } from <span style="color:#a31515">&#34;../../../src/components/news/type&#34;</span>;

describe(<span style="color:#a31515">&#34;Component#news&#34;</span>, <span style="color:#00f">function</span> () {
  beforeEach(async () =&gt; {});

  afterEach(async () =&gt; {});

  it(<span style="color:#a31515">&#34;should get newsList ok!&#34;</span>, async () =&gt; {
    const qs: NewsReq.List = {
      userId: 10,
      kw: <span style="color:#a31515">&#34;æ˜¾å¡ç¦åˆ©&#34;</span>,
      page: 1,
      pageSize: 10,
    };

    const res = await apiTest
      .get(prefix + <span style="color:#a31515">&#34;/news/list&#34;</span>)
      .query(qs)
      .expect(200);

    const body = res.body;
    assert.equal(body.code, 0);

    const data: NewsRes.List = body.data;
    assert.ok(data);
  });

});

ğŸš€ build component news /Users/zhenhua/Workspace/fight-app/doc/swagger.json -&gt; /Users/zhenhua/Workspace/fight-app [122ms]

</code></pre></div><p>ç¬”è€…åœ¨è¿™é‡Œå®ç°äº†ä¸€ä¸ªOpenAPIçš„codegenï¼Œ ç”¨æ¥å¸®åŠ©è‡ªåŠ¨ç”Ÿæˆä¸šåŠ¡ä¸­æ¥å£çš„æµ‹è¯•ï¼Œ å…¶ä¸­apiTestçš„ä»£ç ç”Ÿæˆåªæ˜¯å…¶ä¸­ä¸€å°éƒ¨åˆ†, ç›®å‰codegenæ˜¯åŸºäºç»„ä»¶æ¥ç”Ÿäº§ä»£ç , å¯ä»¥çœ‹åˆ°ä¼šè‡ªåŠ¨æå–schemaçš„exampleç„¶åç”Ÿæˆæµ‹è¯•é€»è¾‘ï¼Œå¹¶æ£€æŸ¥è¿”å›æ˜¯å¦200, ç›®å‰æµ‹è¯•ç”¨ä¾‹ä¸­å¹¶ä¸ä¼šæ£€æŸ¥è¿”å›æ˜¯å¦åŒ¹é…å®šä¹‰çš„schemaç»“æ„ï¼Œè¿™æ˜¯å› ä¸ºç¬”è€…ä¸ºOpenAPIç”Ÿæˆçš„æ¥å£æ˜ å°„å‡½æ•°ä¹Ÿç”Ÿæˆäº†ç±»å‹ç»‘å®šï¼Œå¯ä»¥åœ¨ç¼–è¯‘æœŸç¡®ä¿è¿”å›ç±»å‹å’Œæ–‡æ¡£ç»“æ„åŒ¹é…ï¼Œæ‰€ä»¥æµ‹è¯•è¿™è¾¹å°±ä¸å†éœ€è¦é¢å¤–å¤„ç†</p>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>é€šè¿‡è‡ªåŠ¨ç”Ÿæˆç”¨ä¾‹ä»¥åŠç›¸å…³ä»£ç è‡ªåŠ¨ç”Ÿæˆï¼Œç¬”è€…åœ¨æ–°é¡¹ç›®ä¸­å®ç°äº†å®Œå…¨çš„Design Firstçš„APIå¼€å‘æµç¨‹, åœ¨å®Œæˆæœ€åˆçš„æ–‡æ¡£è®¾è®¡ä¹‹å, å°±å¯ä»¥å’ŒAPIçš„Consumerè¿›è¡Œæ²Ÿé€šåè°ƒï¼Œå¤§å¤§æé«˜äº†å¼€å‘æ•ˆç‡ï¼Œ å¹¶ä¸”é€šè¿‡åœ¨CIä¸­é›†ä¸­æµ‹è¯•ï¼Œå¯ä»¥è½»æ¾ç¡®ä¿æ¯æ¬¡ä¿®æ”¹è°ƒæ•´éƒ½èƒ½ç¬¦åˆæ–‡æ¡£è®¾è®¡,æé«˜äº†æ•´ä½“çš„æ•ˆç‡</p>
<h3 id="æ‰©å±•é˜…è¯»">æ‰©å±•é˜…è¯»</h3>
<p>å¦ä¸€ç§æœ‰è¶£çš„æ€è·¯ï¼ŒRailsç¤¾åŒºçš„<a href="https://github.com/rswag/rswag">rswag</a>, é€šè¿‡æµ‹è¯•æ¥è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£</p>
<!-- raw HTML omitted -->
<h3 id="å‚è€ƒ">å‚è€ƒ</h3>
<p>[1] <a href="https://swagger.io/specification/">OpenAPIæ–‡æ¡£è§„èŒƒ</a></p>
<p>[2] <a href="https://github.com/visionmedia/supertest">SuperTeståº“åœ°å€</a></p>

			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="/tags/openapi">OpenAPI</a></li>
							
							<li><a href="/tags/test">Test</a></li>
							
							<li><a href="/tags/codegen">CodeGen</a></li>
							
						</ul>
					
				
			</div><div id="disqus_thread"></div>
<script type="text/javascript">
	(function () {
		
		
		if (window.location.hostname == "localhost")
			return;

		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		var disqus_shortname = 'dequeue-blog';
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the </a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div>2021  Â© Copyright notice |  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-123-45', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
